# This workflow will build BubbleBar for multiple platforms
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: Build Package

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'
    
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  build:
    name: Build on ${{ matrix.platform }} (Xcode ${{ matrix.xcode }}, ${{ matrix.macos }})
    runs-on: ${{ matrix.macos }}
    strategy:
      fail-fast: false
      matrix:
        xcode: ['16.2']
        macos: ['macos-14']
        platform: ['iOS', 'macOS']
    steps:
    - name: Switch Xcode to ${{ matrix.xcode }}
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: ${{ matrix.xcode }}
        
    - name: Check macOS version (${{ matrix.macos }})
      run: sw_vers
      
    - name: Code Checkout
      uses: actions/checkout@v3
      
    - name: Check Xcode and Swift versions
      run: |
        xcodebuild -version
        swift --version
        
    - name: Skip Macro Validation
      run: defaults write com.apple.dt.Xcode IDESkipMacroFingerprintValidation -bool YES
      
    - name: Build Package for ${{ matrix.platform }}
      run: |
        echo "Building BubbleBar package for ${{ matrix.platform }}..."
        swift build
        
        # Check build result
        if [ $? -eq 0 ]; then
          echo "✅ Package built successfully for ${{ matrix.platform }}"
        else
          echo "❌ Package build failed for ${{ matrix.platform }}"
          exit 1
        fi
